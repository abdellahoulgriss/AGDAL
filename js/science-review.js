const GameState = {    score: 0,    time: 60 * 60,     timerInterval: null,    unlockedUnits: [1],     emergencyMode: true,    completedUnits: []};document.addEventListener('DOMContentLoaded', () => {    setTimeout(initGame, 1500); });function initGame() {    document.getElementById('loadingScreen').style.display = 'none';    startTimer();    updateUI();        initIntro();}function initIntro() {    const bubble = document.querySelector('.speech-bubble');    if (bubble) {        document.querySelector('.professor-area').style.pointerEvents = 'auto';         bubble.innerHTML += `<br><button class="nav-btn" style="background:#ff4757; padding:5px 15px; margin-top:10px; font-size:0.9rem;" onclick="dismissIntro()">ØªÙ…ØŒ Ø§Ø¨Ø¯Ø£!</button>`;    }}function dismissIntro() {    const area = document.querySelector('.professor-area');    area.style.animation = "slideOut 1s forwards";    setTimeout(() => area.style.display = 'none', 1000);}function startTimer() {    GameState.timerInterval = setInterval(() => {        GameState.time--;        const mins = Math.floor(GameState.time / 60);        const secs = GameState.time % 60;        document.getElementById('masterTimer').innerText =            `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;        if (GameState.time <= 0) gameOver();    }, 1000);}function updateUI() {    document.getElementById('totalScore').innerText = GameState.score;        for (let i = 1; i <= 9; i++) {            }}function toggleEmergency() {    GameState.emergencyMode = !GameState.emergencyMode;    const body = document.body;    const statusText = document.querySelector('.status-text');    if (GameState.emergencyMode) {        statusText.innerHTML = '<span style="color:red">Ø®Ø·Ø±! Ø§Ù„Ù…Ø®ØªØ¨Ø± Ù…ØªØ¹Ø·Ù„!</span>';            } else {        statusText.innerHTML = '<span style="color:#0f0">Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø³ØªÙ‚Ø±.</span>';    }}function openUnit(id) {    if (!GlobalData.units[id]) {        console.error("Unit not found:", id);        return;    }        const modal = document.getElementById('unitModal');    const content = document.getElementById('unitContent');        let html = ``;    if (GlobalData.units[id].type === 'game') {        const u = GlobalData.units[id];        html += `<h1 style="text-align:center; color: var(--u-color);">${u.title}</h1>`;        if (u.gameType === 'senses_spy') html += renderSensesGame(u);        else if (u.gameType === 'plant_grow') html += renderPlantGame(u);        else if (u.gameType === 'animal_sort') html += renderAnimalGame(u);        else if (u.gameType === 'water_cycle') html += renderWaterGame(u);        else if (u.gameType === 'air_wind') html += renderAirGame(u);        else if (u.gameType === 'light_shadow') html += renderLightGame(u);        else if (u.gameType === 'force_machine') html += renderForceGame(u);        else if (u.gameType === 'body_scan') html += renderBodyGame(u);        else if (u.gameType === 'elec_circuit') html += renderElectricGame(u);        else html += `<p style="text-align:center;">${u.desc}</p>`;    } else {        html = `            <h1 style="text-align:center; color: var(--u-color);">${GlobalData.units[id].title}</h1>            <div style="text-align:center; padding: 50px;">                <h2>Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ Ù„Ù„ÙˆØ­Ø¯Ø©!</h2>                <p>${GlobalData.units[id].desc}</p>            </div>        `;    }    content.innerHTML = html;    modal.style.display = 'flex';}function renderSensesGame(unit) {    let html = `<div class="game-container" style="text-align:center;">`;    html += `<p class="game-instruction" style="font-size:1.2rem; margin:20px;">${unit.desc}</p>`;    html += `<div id="senses-cards" style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap;">`;    unit.content.forEach((item, idx) => {        let mediaHtml = `<div style="font-size:4rem; margin-bottom:15px;">â“</div>`;        if (item.type === 'sound') {            mediaHtml = `                <div style="font-size:3rem; margin-bottom:10px;">ğŸ”Š</div>                <button class="nav-btn" onclick="playEffect('${item.src}')" style="margin-bottom:15px; background:#4CC9F0;">ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª</button>            `;        } else if (item.type === 'touch') {            mediaHtml = `<div style="font-size:4rem; margin-bottom:15px;">ğŸª¨</div>`;         } else if (item.type === 'smell') {            mediaHtml = `<div style="font-size:4rem; margin-bottom:15px;">ğŸ¤–</div>`;         }        html += `            <div class="sense-card" id="sense-card-${idx}" style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px; width:220px; border:1px solid rgba(255,255,255,0.1);">                ${mediaHtml}                <p style="margin-bottom:15px;">${item.q}</p>                <div class="options" style="display:flex; flex-direction:column; gap:10px;">                    ${item.options.map((opt, optIdx) =>            `<button class="nav-btn" onclick="checkSenseAnswer(${idx}, ${optIdx}, ${item.ans})">${opt}</button>`        ).join('')}                </div>            </div>        `;    });    html += `</div></div>`;    return html;}function playEffect(srcKey) {    const audio = new Audio(`../assets/sounds/${srcKey}.mp3`);        const playPromise = audio.play();    if (playPromise !== undefined) {        playPromise.catch(error => {            console.log("Audio file missing, using TTS fallback.");            let text = "";            if (srcKey === 'bird') text = "ØªÙˆÙŠØª ØªÙˆÙŠØª";            else if (srcKey === 'car') text = "Ø¨ÙŠØ¨ Ø¨ÙŠØ¨";            else if (srcKey === 'cat') text = "Ù…ÙŠØ§Ùˆ Ù…ÙŠØ§Ùˆ";            else text = "ØµÙˆØª " + srcKey;            const u = new SpeechSynthesisUtterance(text);            u.lang = 'ar-SA';            u.rate = 0.8;            window.speechSynthesis.speak(u);        });    }}function checkSenseAnswer(cardIdx, optIdx, correctIdx) {        const card = document.getElementById(`sense-card-${cardIdx}`);    if (optIdx === correctIdx) {        card.style.background = 'rgba(0, 255, 0, 0.2)';        card.style.borderColor = '#0f0';                card.innerHTML = `            <div style="font-size:4rem; animation: popIn 0.5s;">âœ…</div>            <p style="font-weight:bold; font-size:1.5rem;">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!</p>        `;        addToScore(50);                if (cardIdx === 2) checkUnitCompletion(1);    } else {        card.style.background = 'rgba(255, 0, 0, 0.2)';        setTimeout(() => card.style.background = 'rgba(255,255,255,0.05)', 500);    }}function renderPlantGame(unit) {        return `        <div class="game-container" style="text-align:center;">            <p style="font-size:1.2rem; margin:20px;">${unit.desc}</p>            <div class="glass-panel" style="width:300px; height:300px; margin:20px auto; display:flex; align-items:center; justify-content:center; background:linear-gradient(to bottom, #87CEEB 0%, #87CEEB 80%, #8B4513 80%); overflow:hidden; position:relative;">                <div id="plant-stage" style="font-size:8rem; position:absolute; bottom:20px; transition:all 1s;">ğŸŒ°</div>                <div id="sun-overlay" style="position:absolute; top:-50px; right:-50px; width:100px; height:100px; background:yellow; border-radius:50%; box-shadow:0 0 50px orange; opacity:0; transition:opacity 1s;"></div>                <div id="rain-overlay" style="position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,255,0.2); opacity:0; transition:opacity 1s;"></div>            </div>                        <div class="controls" style="display:flex; justify-content:center; gap:20px;">                <button class="nav-btn" onclick="growPlant('soil')">1. ğŸŸ¤ ØªØ±Ø¨Ø©</button>                <button class="nav-btn" onclick="growPlant('water')">2. ğŸ’§ Ø³Ù‚ÙŠ</button>                <button class="nav-btn" onclick="growPlant('sun')">3. â˜€ï¸ Ø´Ù…Ø³</button>            </div>            <p id="plant-msg" style="margin-top:20px; font-weight:bold; color:var(--neon-blue);">Ø§Ø¨Ø¯Ø£ Ø¨ØªØ­Ø¶ÙŠØ± Ø§Ù„ØªØ±Ø¨Ø©!</p>        </div>    `;}let plantLevel = 0;function growPlant(action) {    const stage = document.getElementById('plant-stage');    const msg = document.getElementById('plant-msg');    const sun = document.getElementById('sun-overlay');    const rain = document.getElementById('rain-overlay');    if (plantLevel === 0 && action === 'soil') {        plantLevel++;        stage.innerText = 'ğŸŒ°';        msg.innerText = "Ø£Ø­Ø³Ù†Øª! Ø§Ù„Ø¨Ø°Ø±Ø© ÙÙŠ Ø§Ù„ØªØ±Ø¨Ø©. Ø§Ù„Ø¢Ù† ØªØ­ØªØ§Ø¬ Ø§Ù„Ù…Ø§Ø¡.";    } else if (plantLevel === 1 && action === 'water') {        plantLevel++;        rain.style.opacity = 1;        setTimeout(() => {            rain.style.opacity = 0;            stage.innerText = 'ğŸŒ±';        }, 1000);        msg.innerText = "Ù†Ù…Øª Ø§Ù„Ø¨Ø°Ø±Ø©! Ø§Ù„Ø¢Ù† ØªØ­ØªØ§Ø¬ Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³.";    } else if (plantLevel === 2 && action === 'sun') {        plantLevel++;        sun.style.opacity = 1;        setTimeout(() => {            stage.innerText = 'ğŸŒ»';            stage.style.transform = "scale(1.5)";        }, 1000);        msg.innerText = "Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ù†Ù…Ùˆ! Ù„Ù‚Ø¯ Ø£Ù†Ù‚Ø°Øª Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©! ğŸ‰";        addToScore(150);        checkUnitCompletion(2);    } else {        msg.innerText = "Ø­Ø§ÙˆÙ„ Ø§ØªØ¨Ø§Ø¹ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­: ØªØ±Ø¨Ø© -> Ù…Ø§Ø¡ -> Ø´Ù…Ø³";        msg.style.color = "red";        setTimeout(() => msg.style.color = "var(--neon-blue)", 1000);    }}function renderAnimalGame(unit) {    return `        <div class="game-container" style="text-align:center;">            <p style="font-size:1.2rem; margin:20px;">${unit.desc}</p>            <div style="display:flex; justify-content:center; gap:30px; margin:30px 0;">                <div id="zone-carnivore" style="border:3px dashed #ff4757; background:rgba(255, 71, 87, 0.1); padding:20px; width:200px; min-height:200px; border-radius:20px;">                    <h3 style="color:#ff4757;">ğŸ¥© Ø¢ÙƒÙ„Ø§Øª Ø§Ù„Ù„Ø­ÙˆÙ…</h3>                </div>                <div id="zone-herbivore" style="border:3px dashed #2ed573; background:rgba(46, 213, 115, 0.1); padding:20px; width:200px; min-height:200px; border-radius:20px;">                    <h3 style="color:#2ed573;">ğŸŒ¿ Ø¢ÙƒÙ„Ø§Øª Ø§Ù„Ø¹Ø´Ø¨</h3>                </div>            </div>                        <div id="animal-pool" style="display:flex; gap:15px; justify-content:center; flex-wrap:wrap;">                ${unit.animals.map((a, i) =>        `<div class="draggable-animal" onclick="moveAnimal(this, '${a.type}')"                         style="background:var(--panel-dark); padding:10px 20px; border-radius:10px; cursor:pointer; border:1px solid white; transition:0.3s;">                        ${a.name}                    </div>`    ).join('')}            </div>        </div>    `;}function moveAnimal(el, type) {    const zone = document.getElementById(`zone-${type}`);        zone.appendChild(el);    el.style.background = type === 'carnivore' ? '#ff4757' : '#2ed573';    el.onclick = null;    addToScore(25);    if (document.getElementById('animal-pool').children.length === 0) {        setTimeout(() => {            alert("Ø£Ø­Ø³Ù†Øª! ØµÙ†ÙØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª! ğŸ¦ğŸ°");            checkUnitCompletion(3);        }, 500);    }}function checkUnitCompletion(id) {    if (!GameState.completedUnits.includes(id)) {        GameState.completedUnits.push(id);        const ring = document.querySelector(`.unit-btn[onclick="openUnit(${id})"] .progress-ring`);        if (ring) ring.style.border = '4px solid #0f0';        checkGraduation();    }    modal.style.display = 'flex';}function checkGraduation() {        if (GameState.completedUnits.length >= 9) {        setTimeout(() => {            renderGraduation();        }, 1000);    }        if (GameState.completedUnits.length >= 5 && GameState.emergencyMode) {        toggleEmergency();         alert("Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø¨Ø¯Ø£Øª ØªØ³ØªÙ‚Ø±! ØªØ§Ø¨Ø¹ÙŠ Ø§Ù„Ø¹Ù…Ù„!");    }}function renderGraduation() {    const content = document.getElementById('unitContent');    const modal = document.getElementById('unitModal');    content.innerHTML = `        <div style="text-align:center; animation: popIn 1s;">            <h1>ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ Ø¨Ø·Ù„! ğŸ‰</h1>            <div style="font-size:6rem; margin:20px;">ğŸ“</div>            <h2>Ù„Ù‚Ø¯ Ø£Ù†Ù‚Ø°Øª Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø¹Ù„ÙˆÙ…!</h2>            <p style="font-size:1.5rem;">Ù†Ù‚Ø§Ø·Ùƒ: ${GameState.score}</p>            <p>Ø£Ù†Øª Ø§Ù„Ø¢Ù† "Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„"!</p>            <button class="nav-btn action-btn" onclick="location.href='../index.html'">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙƒØªØ¨Ø©</button>        </div>    `;    modal.style.display = 'flex';        startConfetti();}function startConfetti() {        document.body.style.overflow = 'hidden';    for (let i = 0; i < 50; i++) {        const c = document.createElement('div');        c.style.position = 'fixed';        c.style.left = Math.random() * 100 + 'vw';        c.style.top = '-10px';        c.style.width = '10px';        c.style.height = '10px';        c.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;        c.style.transition = 'top 3s linear';        c.style.zIndex = 9999;        document.body.appendChild(c);        setTimeout(() => {            c.style.top = '100vh';        }, 100);        setTimeout(() => c.remove(), 3000);    }}function closeUnit() {    document.getElementById('unitModal').style.display = 'none';}let arenaQs = [];let arenaIdx = 0;let arenaScore = 0;let arenaTimer = null;function openArena() {    const modal = document.getElementById('unitModal');    const content = document.getElementById('unitContent');    content.innerHTML = `        <h1 style="text-align:center; color: #ff6b6b;">âš”ï¸ Ø³Ø§Ø­Ø© Ø§Ù„ØªØ­Ø¯ÙŠ âš”ï¸</h1>        <div style="text-align:center; padding: 30px;">            <p style="font-size:1.5rem;">Ø£Ø¬Ø¨ Ø¹Ù† 10 Ø£Ø³Ø¦Ù„Ø© Ø¹Ù„Ù…ÙŠØ© Ø¨Ø³Ø±Ø¹Ø©!</p>            <p>Ù„Ø¯ÙŠÙƒ 60 Ø«Ø§Ù†ÙŠØ©.</p>            <button class="nav-btn action-btn" onclick="startArena()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ!</button>        </div>    `;    modal.style.display = 'flex';}function startArena() {        const allQs = [...GlobalData.questions].sort(() => 0.5 - Math.random());    arenaQs = allQs.slice(0, 10);    arenaIdx = 0;    arenaScore = 0;    renderArenaQ();}function renderArenaQ() {    if (arenaIdx >= arenaQs.length) {        endArena();        return;    }    const q = arenaQs[arenaIdx];    const content = document.getElementById('unitContent');    content.innerHTML = `        <div style="text-align:center;">            <div style="display:flex; justify-content:space-between; margin-bottom:20px; font-size:1.2rem;">                <span>Ø§Ù„Ø³Ø¤Ø§Ù„: ${arenaIdx + 1}/10</span>                <span>Ø§Ù„Ù†Ù‚Ø§Ø·: ${arenaScore}</span>            </div>                        <div style="background:#222; padding:30px; border-radius:15px; margin:20px 0; min-height:150px; display:flex; align-items:center; justify-content:center;">                <h2 style="margin:0;">${q.q}</h2>            </div>                        <div style="display:flex; justify-content:center; gap:20px;">                <button class="nav-btn" style="background:#2ed573; flex:1;" onclick="checkArenaAnswer(true)">âœ… ØµØ­ÙŠØ­</button>                <button class="nav-btn" style="background:#ff4757; flex:1;" onclick="checkArenaAnswer(false)">âŒ Ø®Ø·Ø£</button>            </div>        </div>    `;}function checkArenaAnswer(userAns) {    const q = arenaQs[arenaIdx];    if (userAns === q.a) {        arenaScore += 10;            }    arenaIdx++;    renderArenaQ();}function endArena() {    addToScore(arenaScore);    const content = document.getElementById('unitContent');    let medal = arenaScore >= 80 ? "ğŸ¥‡" : (arenaScore >= 50 ? "ğŸ¥ˆ" : "ğŸ¥‰");    content.innerHTML = `        <div style="text-align:center; animation: popIn 0.5s;">            <h1>Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠ!</h1>            <div style="font-size:5rem; margin:20px;">${medal}</div>            <h2>Ù†ØªÙŠØ¬ØªÙƒ: ${arenaScore} / 100</h2>            <p>ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ø±ØµÙŠØ¯Ùƒ.</p>            <button class="nav-btn" onclick="closeUnit()">Ø¥ØºÙ„Ø§Ù‚</button>        </div>    `;}function openExam() {    const modal = document.getElementById('unitModal');    const content = document.getElementById('unitContent');    content.innerHTML = `        <h1 style="text-align:center; color: #ffd32a;">ğŸ“ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h1>        <div style="text-align:center; padding: 30px;">            <p style="font-size:1.5rem;">Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ</p>            <p>40 Ø³Ø¤Ø§Ù„ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ù†Ù‡Ø¬.</p>            <button class="nav-btn action-btn" onclick="startExam()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>        </div>    `;    modal.style.display = 'flex';}function startExam() {        const allQs = [...GlobalData.questions].sort(() => 0.5 - Math.random());    arenaQs = allQs.slice(0, 20);     arenaIdx = 0;    arenaScore = 0;    renderArenaQ(); }function openVirtualLab() {    const modal = document.getElementById('unitModal');    const content = document.getElementById('unitContent');    content.innerHTML = `        <h1 style="text-align:center; color: #0cf;">ğŸ§ª Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</h1>        <div style="text-align:center; padding: 50px;">             <p>Ù…Ø³Ø§Ø­Ø© Ø­Ø±Ø© Ù„Ù„ØªØ¬Ø§Ø±Ø¨.. Ù‚Ø±ÙŠØ¨Ø§Ù‹!</p>             <button class="nav-btn" onclick="closeUnit()">Ø¥ØºÙ„Ø§Ù‚</button>        </div>    `;    modal.style.display = 'flex';}function addToScore(points) {    GameState.score += points;    updateUI();}function renderWaterGame(unit) {    return `        <div class="game-container" style="text-align:center;">             <p style="font-size:1.2rem; margin:20px;">${unit.desc}</p>             <div id="water-slots" style="display:flex; justify-content:center; gap:20px; margin-bottom:30px;">                <div class="slot" data-idx="0" style="width:100px; height:100px; border:2px dashed #4CC9F0; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#ccc;">1</div>                <div class="slot" data-idx="1" style="width:100px; height:100px; border:2px dashed #4CC9F0; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#ccc;">2</div>                <div class="slot" data-idx="2" style="width:100px; height:100px; border:2px dashed #4CC9F0; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#ccc;">3</div>                <div class="slot" data-idx="3" style="width:100px; height:100px; border:2px dashed #4CC9F0; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#ccc;">4</div>             </div>                          <div id="water-options" style="display:flex; justify-content:center; gap:15px;">                 ${unit.stages.sort(() => Math.random() - 0.5).map(s =>        `<button class="nav-btn" onclick="placeWaterStage(this, '${s.id}', '${s.icon} ${s.text}')">${s.icon} ${s.text}</button>`    ).join('')}             </div>        </div>    `;}let waterOrder = [];function placeWaterStage(btn, id, text) {    const slot = document.querySelectorAll('.slot')[waterOrder.length];    if (slot) {        slot.innerHTML = text;        slot.style.border = "2px solid #4CC9F0";        slot.style.color = "white";        waterOrder.push(id);        btn.style.display = 'none';        if (waterOrder.length === 4) {            if (waterOrder[0] === 'evap' && waterOrder[1] === 'cond' && waterOrder[2] === 'prec' && waterOrder[3] === 'coll') {                setTimeout(() => { alert("Ø£Ø­Ø³Ù†Øª! Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø§Ø¡ ØµØ­ÙŠØ­Ø©! ğŸŒ§ï¸ğŸŒŠ"); addToScore(150); checkUnitCompletion(4); }, 500);            } else {                alert("Ø§Ù„ØªØ±ØªÙŠØ¨ Ø®Ø§Ø·Ø¦! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");                waterOrder = [];                setTimeout(() => openUnit(4), 1000);            }        }    }}function renderAirGame(unit) {    return `         <div class="game-container" style="text-align:center;">             <p style="font-size:1.2rem; margin:20px;">${unit.desc}</p>             <div style="position:relative; width:200px; height:200px; margin:20px auto;">                <div id="turbine-blades" style="font-size:8rem; transition:transform 0.1s linear;">âš™ï¸</div>             </div>             <p id="wind-speed-text">Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­: 0 ÙƒÙ…/Ø³</p>             <input type="range" min="0" max="120" value="0" style="width:300px;" oninput="updateTurbine(this.value)">         </div>    `;}function updateTurbine(val) {    const blade = document.getElementById('turbine-blades');    const txt = document.getElementById('wind-speed-text');    blade.style.transform = `rotate(${Date.now() % 360}deg)`;    txt.innerText = `Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­: ${val} ÙƒÙ…/Ø³`;    if (val > 100) {        txt.innerText = "âš¡ ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚ØµÙˆÙ‰! Ø£Ø­Ø³Ù†Øª!";        txt.style.color = "#0f0";        if (val >= 120) {            if (!GameState.completedUnits.includes(5)) {                checkUnitCompletion(5);                addToScore(100);                alert("Ø·Ø§Ù‚Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ’¨âš¡");            }        }    }}function renderLightGame(unit) {    return `        <div class="game-container" style="text-align:center;">             <p style="font-size:1.2rem; margin:20px;">${unit.desc}</p>             <div class="glass-panel" style="width:400px; height:200px; margin:20px auto; position:relative; background:#000; overflow:hidden;">                <div id="light-source" style="position:absolute; top:20px; left:10px; font-size:3rem; filter:drop-shadow(0 0 20px yellow);">ğŸ’¡</div>                <div id="shadow-obj" style="position:absolute; bottom:20px; left:50%; width:20px; height:60px; background:white;"></div>                <div id="shadow-cast" style="position:absolute; bottom:20px; left:52%; width:60px; height:10px; background:rgba(0,0,0,0.8); transform-origin:left; transform:skewX(45deg);"></div>             </div>             <p>Ø­Ø±Ùƒ Ø§Ù„Ù…ØµØ¨Ø§Ø­ Ù„ØªØºÙŠÙŠØ± Ø·ÙˆÙ„ Ø§Ù„Ø¸Ù„!</p>             <input type="range" min="10" max="350" value="10" style="width:300px;" oninput="moveLight(this.value)">        </div>    `;}function moveLight(val) {    const bulb = document.getElementById('light-source');    const shadow = document.getElementById('shadow-cast');    bulb.style.left = val + 'px';    let dist = val - 200;    let skew = dist * -0.3;    let length = 60 + Math.abs(dist * 0.5);    shadow.style.transform = `skewX(${skew}deg)`;    shadow.style.width = length + 'px';    if (val > 180 && val < 220) {        shadow.style.background = 'green';        if (!GameState.completedUnits.includes(6)) {            checkUnitCompletion(6);            addToScore(150);        }    } else {        shadow.style.background = 'rgba(0,0,0,0.8)';    }}function renderForceGame(unit) {    return `        <div class="game-container" style="text-align:center;">             <p style="font-size:1.2rem; margin:20px;">${unit.desc}</p>             <div style="height:250px; position:relative; margin-bottom:30px; border-bottom:10px solid #444; background:linear-gradient(to top, #87CEEB 0%, transparent 100%); overflow:hidden;">                                <!-- LEVER SYSTEM (Hidden initially) -->                <div id="lever-system" style="position:absolute; bottom:0; left:50%; transform:translateX(-50%); width:300px; height:100px; display:none;">                    <div id="fulcrum" style="position:absolute; bottom:0; left:50%; width:0; height:0; border-left:20px solid transparent; border-right:20px solid transparent; border-bottom:40px solid #555;"></div>                    <div id="plank" style="position:absolute; bottom:40px; left:0; width:100%; height:10px; background:#8B4513; transform-origin:50% 100%; transform:rotate(15deg); transition:transform 1s;"></div>                </div>                <!-- REALISTIC ROCK CSS -->                <div id="rock" style="                    width:100px; height:80px;                     background:linear-gradient(135deg, #7f8c8d 0%, #34495e 100%);                     border-radius:40% 50% 30% 40%;                     position:absolute;                     left:40%;                     bottom:0;                     box-shadow:inset -10px -10px 20px rgba(0,0,0,0.5);                    transition:all 1s;                    z-index:2;                    display:flex; align-items:center; justify-content:center;                    font-size:2rem; color:rgba(255,255,255,0.2);                ">ğŸª¨</div>             </div>             <p id="force-msg">Ø§Ù„ØµØ®Ø±Ø© Ø«Ù‚ÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹! Ù…Ø§Ø°Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ù„Ø±ÙØ¹Ù‡Ø§ØŸ</p>             <div style="display:flex; justify-content:center; gap:20px;">                ${unit.tools.map(t =>        `<button class="nav-btn" onclick="useTool('${t.id}')">${t.icon} ${t.name}</button>`    ).join('')}             </div>        </div>    `;}function useTool(toolId) {    const rock = document.getElementById('rock');    const msg = document.getElementById('force-msg');    const leverSys = document.getElementById('lever-system');    const plank = document.getElementById('plank');    if (toolId === 'lever') {        msg.innerText = "Ø£Ø­Ø³Ù†Øª! Ø§Ù„Ø±Ø§ÙØ¹Ø© ØªØ³Ø§Ø¹Ø¯ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ø£Ø«Ù‚Ø§Ù„ Ø¨Ø³Ù‡ÙˆÙ„Ø©!";        msg.style.color = '#0f0';                leverSys.style.display = 'block';        rock.style.left = '35%';         rock.style.bottom = '30px';        setTimeout(() => {                        plank.style.transform = 'rotate(-15deg)';            rock.style.bottom = '100px';            rock.style.transform = 'rotate(20deg)';        }, 500);        addToScore(150);        checkUnitCompletion(7);    } else {        msg.innerText = "Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù‚Ø¯ Ù„Ø§ ØªÙƒÙˆÙ† Ø§Ù„Ø£ÙØ¶Ù„ Ù‡Ù†Ø§.. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";        msg.style.color = 'orange';    }}function renderBodyGame(unit) {    return `        <div class="game-container" style="text-align:center;">             <p style="font-size:1.2rem; margin:20px;">${unit.desc}</p>             <div style="font-size:10rem; margin:20px;" id="patient-face">ğŸ¤’</div>             <p id="body-status">Ø§Ù„Ø¨Ø±ÙˆÙÙŠØ³ÙˆØ± ÙŠØ¹Ø§Ù†ÙŠ Ù…Ù† Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø©!</p>                          <div style="display:flex; justify-content:center; gap:20px; margin-top:20px;">                <button class="nav-btn" onclick="treatPatient('scan')">ğŸ” ÙØ­Øµ</button>                <button class="nav-btn" onclick="treatPatient('pill')">ğŸ’Š Ø¯ÙˆØ§Ø¡</button>                <button class="nav-btn" onclick="treatPatient('water')">ğŸ’§ Ù…Ø§Ø¡</button>             </div>        </div>    `;}function treatPatient(action) {    const face = document.getElementById('patient-face');    const status = document.getElementById('body-status');    if (action === 'scan') {        status.innerText = "Ø§Ù„Ù†ØªÙŠØ¬Ø©: Ø¹Ø¯ÙˆÙ‰ ÙÙŠØ±ÙˆØ³ÙŠØ© Ø¨Ø³ÙŠØ·Ø©. ÙŠØ­ØªØ§Ø¬ Ù„Ù„Ø±Ø§Ø­Ø© ÙˆØ§Ù„Ø¯ÙˆØ§Ø¡.";    } else if (action === 'pill') {        face.innerText = "ğŸ˜";        status.innerText = "Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! Ø§Ù„Ø¨Ø±ÙˆÙÙŠØ³ÙˆØ± ÙŠØ´Ø¹Ø± Ø¨ØªØ­Ø³Ù† ÙƒØ¨ÙŠØ±!";        status.style.color = '#0f0';        addToScore(150);        checkUnitCompletion(8);    } else if (action === 'water') {        status.innerText = "Ø§Ù„Ù…Ø§Ø¡ Ù…ÙÙŠØ¯ØŒ Ù„ÙƒÙ†Ù‡ ÙŠØ­ØªØ§Ø¬ Ø¹Ù„Ø§Ø¬Ø§Ù‹ Ø£Ù‚ÙˆÙ‰.";    }}function renderElectricGame(unit) {    return `        <div class="game-container" style="text-align:center;">             <p style="font-size:1.2rem; margin:20px;">${unit.desc}</p>             <div style="background:#222; padding:30px; border-radius:20px; width:300px; margin:0 auto; border:4px solid #555;">                <div id="elec-bulb" style="font-size:5rem; margin-bottom:20px; color:#444; transition:0.5s;">ğŸ’¡</div>                <div style="display:flex; justify-content:center; gap:10px;">                    <div class="wire" onclick="fixWire(this)" style="width:20px; height:80px; background:red; cursor:pointer;"></div>                    <div class="wire" onclick="fixWire(this)" style="width:20px; height:80px; background:red; cursor:pointer;"></div>                    <div class="wire" onclick="fixWire(this)" style="width:20px; height:80px; background:red; cursor:pointer;"></div>                    <div class="wire" onclick="fixWire(this)" style="width:20px; height:80px; background:red; cursor:pointer;"></div>                </div>             </div>             <p id="elec-msg">Ø§Ù„Ø£Ø³Ù„Ø§Ùƒ Ù…Ù‚Ø·ÙˆØ¹Ø© (Ø­Ù…Ø±Ø§Ø¡). Ø§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡Ø§ Ù„Ø¥ØµÙ„Ø§Ø­Ù‡Ø§ (Ø®Ø¶Ø±Ø§Ø¡)!</p>        </div>    `;}let wiresFixed = 0;function fixWire(el) {    if (el.style.backgroundColor === 'red') {        el.style.backgroundColor = '#0f0';        el.style.boxShadow = '0 0 10px #0f0';        wiresFixed++;        if (wiresFixed === 4) {            document.getElementById('elec-bulb').style.color = 'yellow';            document.getElementById('elec-bulb').style.textShadow = '0 0 50px yellow';            document.getElementById('elec-msg').innerText = "ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¯Ø§Ø±Ø©! Ø¹Ø§Ø¯ Ø§Ù„ØªÙŠØ§Ø±!";            document.getElementById('elec-msg').style.color = '#0f0';            addToScore(150);            checkUnitCompletion(9);        }    }}